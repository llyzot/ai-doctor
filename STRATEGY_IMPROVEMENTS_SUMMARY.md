# 策略性与针对性改进总结

## 概述
针对"策略性不足和针对性不足"的问题，本次改进从**提示词优化**和**系统机制创新**两个维度入手，全面提升AI医生会诊系统的策略思维深度和个体化诊疗能力。

---

## 一、提示词层面的改进

### 1. 全局系统提示词增强
在原有的专业性、独立思考、安全第一等原则基础上，新增：

#### **【策略性要求】**
- ✅ 制定分步骤的诊疗策略（检查确诊 → 治疗方案 → 疗效评估）
- ✅ 提供备选方案（一线方案失败后的次选策略）
- ✅ 风险管理策略（并发症识别、预防措施、应急预案）
- ✅ 长期管理计划（随访、复发预防、生育力保护）

#### **【针对性要求】**
- ✅ 深入分析患者特殊性（年龄特点、既往病史影响、症状独特性）
- ✅ 关注关键细节（提取最有诊断价值的信息，解释临床意义）
- ✅ 结合患者需求（生育需求、手术耐受性、经济依从性）
- ✅ 避免泛泛而谈（每条建议说明"为什么适合这个患者"）

### 2. 最终总结提示词结构化
从简单罗列转变为**策略报告**，要求包含：
1. **诊断策略**：核心诊断+鉴别诊断及排除依据
2. **检查策略**：目的、优先级、预期结果
3. **治疗策略**：分阶段方案（急性期→过渡期→长期）+ 备选方案
4. **风险管理策略**：并发症预警、应急预案
5. **随访策略**：时间点、指标、调整触发条件

### 3. 预设专家提示词全面优化
为12个妇产科专科领域的预设专家注入策略思维，例如：
- **高危妊娠专家**：分层风险评估、监测频率、终止妊娠决策点
- **妇科肿瘤专家**：诊断策略→分期策略→治疗策略→随访策略
- **生殖医学专家**：不孕病因诊断策略、分级治疗策略（升阶梯逻辑）

---

## 二、系统机制层面的创新

### 🎯 创新1：分阶段讨论策略（Multi-Stage Discussion）

**问题**：传统会诊是医生轮流发言，缺乏结构化思维引导。

**创新**：将第一轮会诊拆分为三个渐进式阶段：

#### 阶段一：初步诊断阶段
- 快速建立诊断框架
- 明确需要收集的关键信息
- 提出初步处置建议

#### 阶段二：质疑与辩论阶段
- **主动质疑**其他医生观点中的疑点
- 提出不同见解及支持证据
- 承认他人合理观点并补充分析
- ⚡ **核心价值**：通过学术辩论避免"群体思维"，深挖问题本质

#### 阶段三：共识与优化阶段
- 综合各方观点
- 给出最终诊断与完整策略
- 明确风险管理与备选方案

**配置方式**：
```javascript
settings: {
  discussionStrategy: 'multi-stage'  // 启用分阶段策略
}
```

---

### 🎯 创新2：质疑机制（Challenge Mode）

**问题**：医生往往只发表自己观点，缺少批判性审视。

**创新**：在提示词中明确要求医生：
```
【当前阶段：质疑与辩论】
请批判性地审视其他医生的观点：
1）指出你认为存在疑问或不够准确的观点，并说明理由
2）提出你的不同见解及支持证据
3）如果其他医生提出了你未考虑的重要点，请补充你的分析
要敢于质疑，体现学术辩论精神。
```

**效果**：
- ✅ 提高诊断准确性（暴露思维盲点）
- ✅ 增强论证深度（要求用证据支持观点）
- ✅ 促进知识交流（在辩论中相互学习）

**配置方式**：
```javascript
settings: {
  enableChallengeMode: true  // 启用质疑模式
}
```

---

### 🎯 创新3：关键问题自动提取

**问题**：临床诊断常因信息不足受限，患者不知道需要补充什么。

**创新**：
- 自动识别医生发言中的关键问题（使用正则匹配问号句式）
- 在聊天界面中高亮显示为紫色"❓关键问题"标签
- 帮助患者聚焦补充信息

**识别模式**：
- "需要/是否/有无/能否" + 问号
- "请...补充/提供/说明" + 问号
- "什么/哪些/多久/如何/为何" + 问号

**效果**：
- ✅ 明确告知患者需要补充什么信息
- ✅ 减少信息盲点，提高诊断效率
- ✅ 增强医患交互性

**配置方式**：
```javascript
settings: {
  enableQuestionExtraction: true  // 启用关键问题提取
}
```

---

### 🎯 创新4：阶段状态可视化

**UI改进**：
- 在讨论面板顶部显示当前阶段，例如：
  ```
  当前阶段：讨论中 · 质疑与辩论
  ```
- 在聊天历史中插入阶段标识：
  ```
  【初步诊断阶段】
  【质疑与辩论阶段】
  【共识与优化阶段】
  ```

---

## 三、技术实现亮点

### 1. 动态提示词生成
`buildFullPrompt` 函数支持 `options` 参数：
```javascript
buildFullPrompt(systemPrompt, caseInfo, history, doctorId, linked, {
  roundPhase: 'challenge',         // 当前讨论阶段
  enableChallengeMode: true        // 是否启用质疑模式
})
```

根据 `roundPhase` 自动调整用户提示词：
- `'initial'`: "请给出你的初步诊断思路..."
- `'challenge'`: "请批判性地审视其他医生的观点..."
- `'consensus'`: "综合前面的讨论，请给出你的最终判断..."

### 2. 状态机管理
新增 `workflow` 状态字段：
```javascript
workflow: {
  roundPhase: null,           // 当前讨论阶段（initial/challenge/consensus）
  detectedQuestions: []       // 提取的关键问题列表
}
```

### 3. 零侵入扩展原则
- 所有创新机制通过配置项控制
- 不破坏原有 `standard` 标准模式
- 保持向后兼容性

---

## 四、效果对比

### ❌ 改进前的典型回复：
```
根据患者的症状和检查结果，考虑可能是子宫肌瘤。
建议进一步检查并根据情况选择合适的治疗方案。
```
**问题**：泛泛而谈，缺少策略步骤，未体现个体化考量。

### ✅ 改进后的典型回复：
```
【核心判断】
本患者为35岁育龄期女性，结合月经量增多、超声提示多发性子宫肌瘤（最大直径5cm），
初步诊断为症状性子宫肌瘤。

【诊疗策略】
1. 近期检查策略：
   - 完善MRI明确肌瘤位置与数量（目的：评估手术难度）
   - 检测血常规、铁蛋白（目的：评估贫血程度，决定是否需要术前纠正）

2. 治疗策略：
   一线方案：考虑患者仍有生育需求，优先腹腔镜下肌瘤剔除术
   备选方案：若术中发现肌瘤弥漫分布难以剥除，可考虑GnRH-a预处理3个月后再次评估

3. 风险管理：
   - 术中出血风险：准备自体血回输，必要时宫腔球囊压迫
   - 术后粘连风险：术中使用防粘连屏障，术后早期超声监测

4. 随访策略：
   - 术后3个月、6个月、12个月复查超声
   - 如计划妊娠，建议术后至少12个月再孕（子宫瘢痕愈合）

【个体化考量】
- 该患者35岁且有生育需求，因此优先保守性手术而非子宫切除
- 月经量增多已导致血红蛋白偏低，术前需纠正贫血以降低手术风险
- 肌瘤5cm属于微创手术适应症，符合患者对创伤小、恢复快的期望
```

---

## 五、使用建议

### 首次使用
1. 确保 `discussionStrategy` 设置为 `'multi-stage'`
2. 启用 `enableChallengeMode` 和 `enableQuestionExtraction`
3. 体验完整的三阶段讨论流程

### 复杂病例
- 启用质疑模式，充分辩论各种诊断可能性

### 信息不足
- 关注提取的关键问题，针对性补充信息

### 快速会诊
- 使用 `standard` 模式 + 增强提示词，即可获得高质量策略建议

---

## 六、核心价值

### 1. 策略性提升
- ✅ 从"给出建议"到"制定策略"
- ✅ 从"单一方案"到"分步骤+备选方案"
- ✅ 从"关注当前"到"长期管理规划"

### 2. 针对性提升
- ✅ 从"教科书式通用建议"到"患者特异性分析"
- ✅ 从"罗列检查"到"解释为什么适合这个患者"
- ✅ 从"忽略个体差异"到"综合考量年龄/生育需求/经济依从性"

### 3. 真实性提升
- ✅ 分阶段讨论模拟真实临床思维过程
- ✅ 质疑与辩论模拟真实学术会议
- ✅ 关键问题提取模拟真实医患交流

---

## 七、文件变更清单

### 核心文件
- `src/utils/prompt.js` - buildFullPrompt 支持阶段参数
- `src/store/index.js` - 新增 runStageDiscussion、extractKeyQuestions 方法
- `src/store/global.js` - 优化12个预设专家提示词
- `src/components/ChatDisplay.vue` - 新增关键问题显示
- `src/components/DiscussionPanel.vue` - 新增阶段状态显示
- `src/components/StatusPanel.vue` - 更新 resetAll 函数

### 新增文档
- `STRATEGY_INNOVATIONS.md` - 策略创新详细说明
- `STRATEGY_IMPROVEMENTS_SUMMARY.md` - 本总结文档

---

## 八、后续扩展方向

1. **双向投票机制**：不仅投"最不准确"，还投"最佳方案"
2. **策略对比视图**：并排展示不同医生的策略差异
3. **AI辅助决策**：自动分析讨论内容，提示遗漏的关键点
4. **多轮迭代优化**：在后续轮次中针对特定争议点深入讨论

---

## 总结

本次改进通过**提示词工程优化**和**系统机制创新**的双重手段，实现了从"简单问答"到"策略性会诊"的质的飞跃。核心亮点在于：

1. **策略性**：分步骤诊疗策略 + 备选方案 + 风险管理 + 长期规划
2. **针对性**：个体化分析 + 关键细节聚焦 + 患者需求结合
3. **创新性**：分阶段讨论 + 质疑机制 + 关键问题提取

这些改进使得AI医生会诊系统不仅能给出"正确答案"，更能展现"临床思维过程"和"决策逻辑"，为用户提供真正有价值的诊疗策略指导。
