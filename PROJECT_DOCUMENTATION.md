# AI å¦‡äº§ç§‘å¤šä¸“å®¶ä¼šè¯Šç³»ç»Ÿ - é¡¹ç›®æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
- [çŠ¶æ€ç®¡ç†](#çŠ¶æ€ç®¡ç†)
- [AI æ¨¡å‹é›†æˆ](#ai-æ¨¡å‹é›†æˆ)
- [ä¸šåŠ¡æµç¨‹](#ä¸šåŠ¡æµç¨‹)
- [æ•°æ®æŒä¹…åŒ–](#æ•°æ®æŒä¹…åŒ–)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [éƒ¨ç½²è¯´æ˜](#éƒ¨ç½²è¯´æ˜)
- [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹

AI å¦‡äº§ç§‘å¤šä¸“å®¶ä¼šè¯Šç³»ç»Ÿæ˜¯ä¸€ä¸ªé¢å‘å¦‡äº§ç§‘é¢†åŸŸçš„æ™ºèƒ½ä¼šè¯Šå¹³å°ï¼Œé€šè¿‡é›†æˆå¤šä¸ªå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ‰®æ¼”ä¸åŒäºšä¸“ç§‘çš„å¦‡äº§ç§‘åŒ»ç”Ÿï¼Œå®ç°å¤šä¸“å®¶ååŒè¯Šæ–­ã€‚ç³»ç»Ÿé‡‡ç”¨çº¯å‰ç«¯æ¶æ„ï¼Œæ— éœ€åç«¯æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­è°ƒç”¨å„å¤§ AI æœåŠ¡å•†çš„ APIã€‚

**åœ¨çº¿æ¼”ç¤º**: https://dragonchencl.github.io/ai-doctor/

### æ ¸å¿ƒç‰¹æ€§

- ğŸ¥ **å¦‡äº§ç§‘å¤šä¸“å®¶åä½œ**: æ”¯æŒæ·»åŠ å¤šä¸ªç”±ä¸åŒ LLM é©±åŠ¨çš„å¦‡äº§ç§‘åŒ»ç”Ÿå‚ä¸ä¼šè¯Šï¼Œæ¶µç›–é«˜å±å¦Šå¨ ã€å¦‡ç§‘è‚¿ç˜¤ã€ç”Ÿæ®–å†…åˆ†æ³Œã€å¦‡ç§‘å¾®åˆ›ã€äº§ç§‘æ€¥ç—‡ç­‰äºšä¸“ç§‘
- ğŸ¤– **å¤šæ¨¡å‹æ”¯æŒ**: é›†æˆ OpenAIã€Anthropic Claudeã€Google Geminiã€ç¡…åŸºæµåŠ¨ã€é­”æ­ç¤¾åŒºç­‰ä¸»æµ AI æ¨¡å‹
- ğŸ’¬ **å®æ—¶è®¨è®º**: åŒ»ç”Ÿè½®æµå‘è¨€ï¼Œæ”¯æŒæ‰“å­—æœºæ•ˆæœå±•ç¤º
- ğŸ—³ï¸ **æ™ºèƒ½è¯„ä¼°**: åŒ»ç”Ÿäº’ç›¸è¯„ä¼°å½¼æ­¤çš„è¯Šæ–­ï¼Œè‡ªåŠ¨æ·˜æ±°ä¸å‡†ç¡®çš„æ„è§
- ğŸ“‹ **å¦‡äº§ç§‘ä¸“ç—…é‡‡é›†**: æœˆç»å²ã€å©šè‚²å²ã€æ—¢å¾€å¦‡ç§‘ç—…å²ç­‰ä¸“ç§‘åŒ–ç—…ä¾‹é‡‡é›†
- ğŸ–¼ï¸ **å¦‡äº§ç§‘å½±åƒè¯†åˆ«**: æ”¯æŒBè¶…ã€é˜´è¶…ã€å®«è…”é•œç­‰å½±åƒèµ„æ–™çš„AIè¯†åˆ«ä¸åˆ†æ
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: å®æ—¶æ˜¾ç¤ºä¼šè¯Šé˜¶æ®µã€è½®æ¬¡ã€åŒ»ç”ŸçŠ¶æ€ç­‰ä¿¡æ¯
- ğŸ’¾ **ä¼šè¯ç®¡ç†**: è‡ªåŠ¨ä¿å­˜ä¼šè¯Šè®°å½•ï¼Œæ”¯æŒå¤šä¸ªé—®è¯Šä¼šè¯åˆ‡æ¢
- âš ï¸ **æ€¥ç—‡é£é™©è¯†åˆ«**: ç‰¹åˆ«å…³æ³¨å¼‚ä½å¦Šå¨ ã€èƒç›˜æ—©å‰¥ã€äº§åå‡ºè¡€ç­‰äº§ç§‘æ€¥ç—‡
- ğŸ’Š **å¦Šå¨ æœŸç”¨è¯å®‰å…¨**: æ²»ç–—å»ºè®®å¼ºè°ƒå­•æœŸä¸å“ºä¹³æœŸç”¨è¯å®‰å…¨
- ğŸ”— **å…³è”é—®è¯Š**: æ”¯æŒå…³è”å†å²é—®è¯Šè®°å½•ï¼Œæä¾›æ›´å…¨é¢çš„è¯Šæ–­å‚è€ƒ

### æŠ€æœ¯äº®ç‚¹

1. **æ— æœåŠ¡å™¨æ¶æ„**: å®Œå…¨åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼Œé™ä½éƒ¨ç½²æˆæœ¬
2. **å¤š AI æ¨¡å‹å¹¶è¡Œ**: åŒæ—¶è°ƒç”¨ä¸åŒçš„ AI æ¨¡å‹è¿›è¡Œä¼šè¯Š
3. **å¦‡äº§ç§‘ä¸“ç—…æç¤ºè¯ä½“ç³»**: é’ˆå¯¹ä¸åŒäºšä¸“ç§‘æ„å»ºä¸“å±æç¤ºè¯ä¸è¯Šæ–­æµç¨‹
4. **æ™ºèƒ½æŠ•ç¥¨æœºåˆ¶**: é€šè¿‡ AI äº’è¯„å®ç°è¯Šæ–­æ„è§çš„ä¼˜èƒœåŠ£æ±°
5. **éšç§ä¿æŠ¤**: æ•°æ®ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œä¸ä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Vue.js** | ^3.4.21 | å‰ç«¯æ¡†æ¶ï¼Œæä¾›å“åº”å¼ UI |
| **Pinia** | ^2.1.7 | çŠ¶æ€ç®¡ç†åº“ï¼Œç®¡ç†åº”ç”¨çŠ¶æ€ |
| **Ant Design Vue** | ^4.2.1 | UI ç»„ä»¶åº“ï¼Œæä¾›ä¼ä¸šçº§ç»„ä»¶ |
| **Vite** | ^5.2.8 | æ„å»ºå·¥å…·ï¼Œå¿«é€Ÿå¼€å‘å’Œæ„å»º |
| **Axios** | ^1.6.7 | HTTP å®¢æˆ·ç«¯ï¼Œè°ƒç”¨ AI API |
| **Marked** | ^9.1.6 | Markdown æ¸²æŸ“ï¼Œå±•ç¤º AI å›å¤ |
| **html-to-image** | ^1.11.11 | å›¾ç‰‡å¯¼å‡ºåŠŸèƒ½ |
| **vuedraggable** | ^4.1.0 | æ‹–æ‹½æ’åºåŠŸèƒ½ |

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµè§ˆå™¨ç¯å¢ƒ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Vue 3 App  â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Ant Design  â”‚                   â”‚
â”‚  â”‚  (ç»„ä»¶å±‚)     â”‚        â”‚     UI       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                                                     â”‚
â”‚         â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚        Pinia Store (çŠ¶æ€ç®¡ç†)         â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ consult store â”‚ global   â”‚ sessions  â”‚                   â”‚
â”‚  â”‚  (ä¼šè¯Šæµç¨‹)   â”‚  (å…¨å±€)  â”‚  (ä¼šè¯)   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚          â”‚                                                    â”‚
â”‚          â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚         API è°ƒç”¨å±‚                    â”‚                   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚  â”‚callAI  â”‚  â”‚models  â”‚  â”‚http    â”‚ â”‚                   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                 â”‚                                             â”‚
â”‚                 â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚       localStorage (æ•°æ®æŒä¹…åŒ–)       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTPS API è°ƒç”¨
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¬¬ä¸‰æ–¹ AI æœåŠ¡å•†                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   OpenAI     â”‚  Anthropic   â”‚   Gemini     â”‚   å…¶ä»–å›½å†…å‚å•†  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
ç”¨æˆ·è¾“å…¥ç—…ä¾‹
    â”‚
    â–¼
åˆ›å»º/æ›´æ–° Store çŠ¶æ€
    â”‚
    â–¼
å¼€å§‹ä¼šè¯Šæµç¨‹ â”€â”€â”
    â”‚          â”‚
    â–¼          â”‚
åŒ»ç”Ÿè½®æµå‘è¨€   â”‚
    â”‚          â”‚
    â”œâ”€ è°ƒç”¨ AI API
    â”‚          â”‚
    â–¼          â”‚
æ˜¾ç¤ºåŒ»ç”Ÿå›å¤   â”‚
    â”‚          â”‚
    â–¼          â”‚
è¯„ä¼°æŠ•ç¥¨é˜¶æ®µ   â”‚
    â”‚          â”‚
    â–¼          â”‚
æ·˜æ±°åŒ»ç”Ÿ      â”‚
    â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (å¾ªç¯ç›´åˆ°ç»“æŸæ¡ä»¶)
    â”‚
    â–¼
ç”Ÿæˆæœ€ç»ˆè¯Šæ–­
    â”‚
    â–¼
ä¿å­˜åˆ° localStorage
```

---

## é¡¹ç›®ç»“æ„

### ç›®å½•æ ‘

```
ai-medical-consultation-panel/
â”œâ”€â”€ public/                          # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                         # API è°ƒç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ callAI.js                # AI æ¨¡å‹è°ƒç”¨å°è£… (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ http.js                  # HTTP ä»£ç†é…ç½®
â”‚   â”‚   â”œâ”€â”€ imageRecognition.js      # å›¾åƒè¯†åˆ« API
â”‚   â”‚   â””â”€â”€ models.js                # æ¨¡å‹åˆ—è¡¨è·å–
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                      # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ logo.svg                 # Logo å›¾æ ‡
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                  # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CaseInputForm.vue        # ç—…ä¾‹è¾“å…¥è¡¨å•
â”‚   â”‚   â”œâ”€â”€ ChatDisplay.vue          # èŠå¤©è®°å½•æ˜¾ç¤º
â”‚   â”‚   â”œâ”€â”€ ConsultationSettingsModal.vue  # é—®è¯Šè®¾ç½®å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ DiscussionPanel.vue      # è®¨è®ºé¢æ¿ (æ ¸å¿ƒç»„ä»¶)
â”‚   â”‚   â”œâ”€â”€ DoctorList.vue           # åŒ»ç”Ÿåˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ ExpandableText.vue       # å¯å±•å¼€æ–‡æœ¬ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ GlobalSettingsModal.vue  # å…¨å±€è®¾ç½®å¼¹çª— (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ SessionListDrawer.vue    # ä¼šè¯åˆ—è¡¨æŠ½å±‰
â”‚   â”‚   â”œâ”€â”€ StatusPanel.vue          # çŠ¶æ€é¢æ¿ (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ VoteTally.vue            # æŠ•ç¥¨ç»Ÿè®¡
â”‚   â”‚   â””â”€â”€ VotingControls.vue       # æŠ•ç¥¨æ§åˆ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/                 # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â””â”€â”€ useImageRecognitionQueue.js  # å›¾åƒè¯†åˆ«é˜Ÿåˆ—ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                       # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.js                 # ä¼šè¯Šæµç¨‹çŠ¶æ€ (æ ¸å¿ƒ Store)
â”‚   â”‚   â”œâ”€â”€ global.js                # å…¨å±€é…ç½®çŠ¶æ€
â”‚   â”‚   â””â”€â”€ sessions.js              # ä¼šè¯ç®¡ç†çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ prompt.js                # æç¤ºè¯æ„å»º (æ ¸å¿ƒ)
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                      # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.js                      # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ index.html                       # HTML æ¨¡æ¿
â”œâ”€â”€ vite.config.js                   # Vite é…ç½®
â”œâ”€â”€ package.json                     # é¡¹ç›®é…ç½®
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                       # Git å¿½ç•¥é…ç½®
â”œâ”€â”€ README.md                        # ç”¨æˆ·æ–‡æ¡£
â”œâ”€â”€ README.zh.md                     # ä¸­æ–‡æ–‡æ¡£
â””â”€â”€ PROJECT_DOCUMENTATION.md         # é¡¹ç›®æŠ€æœ¯æ–‡æ¡£ (æœ¬æ–‡æ¡£)
```

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

#### 1. **src/store/index.js** (ä¼šè¯Šæµç¨‹æ ¸å¿ƒ)

ç®¡ç†æ•´ä¸ªä¼šè¯Šæµç¨‹çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼š
- ç—…ä¾‹ä¿¡æ¯ (`patientCase`)
- åŒ»ç”Ÿåˆ—è¡¨ (`doctors`)
- å·¥ä½œæµçŠ¶æ€ (`workflow`)
- å¯¹è¯å†å² (`messages`)
- æŠ•ç¥¨ç»“æœ (`voteTally`)

ä¸»è¦ Actions:
- `startConsultation()`: å¯åŠ¨ä¼šè¯Š
- `runDiscussion()`: æ‰§è¡Œè®¨è®ºè½®æ¬¡
- `requestVote()`: è¯·æ±‚æŠ•ç¥¨
- `processFinalSummary()`: ç”Ÿæˆæœ€ç»ˆæ€»ç»“

#### 2. **src/api/callAI.js** (AI è°ƒç”¨æ ¸å¿ƒ)

å°è£…äº†å¯¹ä¸åŒ AI ä¾›åº”å•†çš„ API è°ƒç”¨ï¼š
- `callOpenAI()`: OpenAI è§„èŒƒè°ƒç”¨
- `callAnthropic()`: Anthropic Claude è°ƒç”¨
- `callGemini()`: Google Gemini è°ƒç”¨
- `callSiliconFlow()`: ç¡…åŸºæµåŠ¨è°ƒç”¨
- `callModelScope()`: é­”æ­ç¤¾åŒºè°ƒç”¨

#### 3. **src/utils/prompt.js** (æç¤ºè¯æ„å»º)

æ„å»ºå‘é€ç»™ AI çš„æç¤ºè¯ï¼š
- `buildFullPrompt()`: æ„å»ºåŒ»ç”Ÿå‘è¨€æç¤ºè¯
- `buildVotePrompt()`: æ„å»ºæŠ•ç¥¨è¯„ä¼°æç¤ºè¯
- `buildFinalSummaryPrompt()`: æ„å»ºæœ€ç»ˆæ€»ç»“æç¤ºè¯
- `formatHistoryForProvider()`: æ ¼å¼åŒ–å¯¹è¯å†å²

#### 4. **src/components/GlobalSettingsModal.vue** (å…¨å±€é…ç½®)

ç®¡ç†å…¨å±€é…ç½®çš„æ ¸å¿ƒ UI ç»„ä»¶ï¼š
- åŒ»ç”Ÿé…ç½®ç®¡ç† (æ·»åŠ /ç¼–è¾‘/åˆ é™¤åŒ»ç”Ÿ)
- å…¨å±€ç³»ç»Ÿæç¤ºè¯
- æœ€ç»ˆæ€»ç»“æç¤ºè¯
- å‘è¨€é¡ºåºè®¾ç½®
- å›¾åƒè¯†åˆ«é…ç½®
- é¢„è®¾æç¤ºè¯ç®¡ç†

#### 5. **src/components/DiscussionPanel.vue** (è®¨è®ºé¢æ¿)

æ˜¾ç¤ºä¼šè¯Šè®¨è®ºçš„ä¸»è¦ UI ç»„ä»¶ï¼š
- ç—…ä¾‹è¾“å…¥è¡¨å•
- å¯¹è¯å†å²å±•ç¤º
- æ‰“å­—æœºæ•ˆæœ
- æœ€ç»ˆç­”æ¡ˆå±•ç¤º

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ä¼šè¯Šæµç¨‹ç®¡ç†

**æ–‡ä»¶**: `src/store/index.js`

#### å·¥ä½œæµé˜¶æ®µ (Phase)

```javascript
phase: 'setup' | 'discussing' | 'voting' | 'summary' | 'finished'
```

- **setup**: åˆå§‹åŒ–é˜¶æ®µï¼Œç”¨æˆ·è¾“å…¥ç—…ä¾‹ä¿¡æ¯
- **discussing**: è®¨è®ºé˜¶æ®µï¼ŒåŒ»ç”Ÿè½®æµå‘è¨€
- **voting**: æŠ•ç¥¨é˜¶æ®µï¼ŒåŒ»ç”Ÿäº’ç›¸è¯„ä¼°
- **summary**: æ€»ç»“é˜¶æ®µï¼Œç”Ÿæˆæœ€ç»ˆè¯Šæ–­
- **finished**: å®Œæˆé˜¶æ®µï¼Œæ˜¾ç¤ºæœ€ç»ˆç»“æœ

#### ä¼šè¯Šå¯åŠ¨æµç¨‹

```javascript
startConsultation() {
  // 1. éªŒè¯è¾“å…¥
  if (!this.patientCase.name || !this.patientCase.currentProblem) {
    throw new Error('å¿…å¡«é¡¹ç¼ºå¤±')
  }
  
  // 2. åˆå§‹åŒ–åŒ»ç”ŸçŠ¶æ€
  this.doctors.forEach(d => {
    d.status = 'active'
    d.votes = 0
  })
  
  // 3. è®¾ç½®å·¥ä½œæµ
  this.workflow.phase = 'discussing'
  this.workflow.currentRound = 1
  
  // 4. å¼€å§‹è®¨è®º
  this.runDiscussion()
}
```

#### è®¨è®ºè½®æ¬¡æµç¨‹

```javascript
async runDiscussion() {
  // 1. ç¡®å®šå‘è¨€é¡ºåº
  const queue = this.settings.turnOrder === 'random' 
    ? shuffle(activeDoctors) 
    : activeDoctors
  
  // 2. åŒ»ç”Ÿä¾æ¬¡å‘è¨€
  for (const doctor of queue) {
    const prompt = buildFullPrompt(doctor, patientCase, messages)
    const reply = await callAI(doctor, prompt, history)
    
    this.messages.push({
      role: 'doctor',
      doctorId: doctor.id,
      content: reply
    })
  }
  
  // 3. è¿›å…¥æŠ•ç¥¨é˜¶æ®µ
  this.workflow.phase = 'voting'
  this.requestVote()
}
```

### 2. æŠ•ç¥¨è¯„ä¼°æœºåˆ¶

**æ–‡ä»¶**: `src/store/index.js` - `requestVote()` action

#### æŠ•ç¥¨æµç¨‹

```javascript
async requestVote() {
  const votes = {}
  
  // 1. æ¯ä½åŒ»ç”Ÿè¿›è¡Œè¯„ä¼°
  for (const doctor of activeDoctors) {
    const votePrompt = buildVotePrompt(doctor, messages, activeDoctors)
    const response = await callAI(doctor, votePrompt, [])
    
    // 2. è§£ææŠ•ç¥¨ç»“æœ
    const targetName = parseVoteResponse(response)
    if (targetName) {
      votes[targetName] = (votes[targetName] || 0) + 1
    }
  }
  
  // 3. ç»Ÿè®¡å¹¶æ·˜æ±°
  const maxVotes = Math.max(...Object.values(votes))
  if (maxVotes > 0) {
    const eliminated = findDoctorWithVotes(maxVotes)
    eliminated.status = 'eliminated'
  }
  
  // 4. åˆ¤æ–­æ˜¯å¦ç»§ç»­
  if (activeDoctors.length === 1) {
    this.processFinalSummary()
  } else {
    this.workflow.currentRound++
    this.runDiscussion()
  }
}
```

#### æŠ•ç¥¨æç¤ºè¯ç¤ºä¾‹

```javascript
function buildVotePrompt(doctor, messages, activeDoctors) {
  return {
    system: "ä½ æ˜¯åŒ»ç”Ÿè¯„å®¡å§”å‘˜ï¼Œéœ€è¦è¯„ä¼°å…¶ä»–åŒ»ç”Ÿçš„è¯Šæ–­è´¨é‡",
    user: `
è¯·è¯„ä¼°æœ¬è½®è®¨è®ºä¸­çš„æ‰€æœ‰åŒ»ç”Ÿå‘è¨€ï¼Œé€‰æ‹©ä¸€ä½ä½ è®¤ä¸º"ä¸å¤ªå‡†ç¡®"çš„åŒ»ç”Ÿã€‚

å‚ä¸åŒ»ç”Ÿ: ${activeDoctors.map(d => d.name).join(', ')}

æœ¬è½®å‘è¨€:
${formatMessages(messages)}

è¯·ç›´æ¥è¾“å‡ºä½ é€‰æ‹©çš„åŒ»ç”Ÿåå­—ï¼Œä¾‹å¦‚: Dr. GPT-4
    `
  }
}
```

### 3. å›¾åƒè¯†åˆ«åŠŸèƒ½

**æ–‡ä»¶**: 
- `src/api/imageRecognition.js` - API è°ƒç”¨
- `src/composables/useImageRecognitionQueue.js` - é˜Ÿåˆ—ç®¡ç†
- `src/store/global.js` - é…ç½®ç®¡ç†

#### å›¾åƒè¯†åˆ«æµç¨‹

```javascript
// 1. ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
const file = event.target.files[0]
const dataUrl = await readFileAsDataUrl(file)

// 2. æ·»åŠ åˆ°è¯†åˆ«é˜Ÿåˆ—
const recognition = {
  id: generateId(),
  name: file.name,
  dataUrl: dataUrl,
  status: 'queued'
}

// 3. è°ƒç”¨ AI è¯†åˆ« API
const result = await recognizeImage(dataUrl, {
  provider: config.provider,
  model: config.model,
  apiKey: config.apiKey,
  prompt: config.prompt
})

// 4. æ›´æ–°ç»“æœ
recognition.status = 'success'
recognition.result = result
```

#### æ”¯æŒçš„è¯†åˆ«ä¾›åº”å•†

- **ç¡…åŸºæµåŠ¨**: `Pro/Qwen/Qwen2-VL-72B-Instruct` (é»˜è®¤)
- **OpenAI**: `gpt-4o`, `gpt-4o-mini` (æ”¯æŒ vision)
- **å…¶ä»–å…¼å®¹ OpenAI æ ¼å¼çš„ä¾›åº”å•†**

### 4. å…³è”é—®è¯ŠåŠŸèƒ½

**æ–‡ä»¶**: `src/store/index.js` - `linkedConsultations`

#### å…³è”é—®è¯Šç”¨é€”

- æä¾›å†å²è¯Šæ–­å‚è€ƒ
- è¿½è¸ªæ‚£è€…ç—…æƒ…å‘å±•
- è¾…åŠ©åŒ»ç”Ÿåšå‡ºæ›´å‡†ç¡®çš„è¯Šæ–­

#### æ•°æ®ç»“æ„

```javascript
{
  linkedConsultations: [
    {
      id: 'session-123',
      sourceId: 'session-123',
      consultationName: '2024-01-01 æ„Ÿå†’é—®è¯Š',
      patientName: 'å¼ ä¸‰',
      patientGender: 'ç”·',
      patientAge: 35,
      pastHistory: 'é«˜è¡€å‹ç—…å²',
      currentProblem: 'å‘çƒ­ã€å’³å—½',
      imageRecognitionResult: '...',
      finalSummary: '...',
      finishedAt: '2024-01-01T10:00:00.000Z'
    }
  ]
}
```

### 5. ä¼šè¯ç®¡ç†

**æ–‡ä»¶**: `src/store/sessions.js`

#### ä¼šè¯åˆ—è¡¨åŠŸèƒ½

- è‡ªåŠ¨ä¿å­˜æ¯æ¬¡ä¼šè¯Š
- æ”¯æŒåˆ‡æ¢å†å²ä¼šè¯
- åˆ é™¤ä¸éœ€è¦çš„ä¼šè¯
- å¤åˆ¶ä¼šè¯åˆ›å»ºæ–°é—®è¯Š

#### ä¼šè¯æ•°æ®ç»“æ„

```javascript
{
  id: 'session-uuid',
  name: 'è‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·å‘½å',
  createdAt: 1234567890000,
  updatedAt: 1234567890000,
  snapshot: {
    consultationName: '...',
    patientCase: {...},
    doctors: [...],
    messages: [...],
    workflow: {...},
    // ... å…¶ä»–çŠ¶æ€
  }
}
```

---

## çŠ¶æ€ç®¡ç†

### Store æ¶æ„

ç³»ç»Ÿä½¿ç”¨ Pinia ç®¡ç†ä¸‰ä¸ªç‹¬ç«‹çš„ Storeï¼š

```javascript
// 1. consult store - ä¼šè¯Šæµç¨‹çŠ¶æ€
useConsultStore()

// 2. global store - å…¨å±€é…ç½®
useGlobalStore()

// 3. sessions store - ä¼šè¯ç®¡ç†
useSessionsStore()
```

### 1. Consult Store (src/store/index.js)

#### State ç»“æ„

```javascript
{
  // é—®è¯Šåç§°
  consultationName: '',
  
  // å…¨å±€è®¾ç½®
  settings: {
    globalSystemPrompt: '...',      // å…¨å±€ç³»ç»Ÿæç¤ºè¯
    summaryPrompt: '...',            // æœ€ç»ˆæ€»ç»“æç¤ºè¯
    turnOrder: 'random',             // å‘è¨€é¡ºåº: random | sequential
    maxRoundsWithoutElimination: 3   // æœ€å¤§æ— æ·˜æ±°è½®æ•°
  },
  
  // å‚ä¸é—®è¯Šçš„åŒ»ç”Ÿ
  doctors: [
    {
      id: 'doc-1',
      name: 'Dr. GPT-4',
      provider: 'openai',
      model: 'gpt-4o',
      apiKey: '...',
      baseUrl: '',
      customPrompt: '',
      status: 'active',               // active | eliminated | excluded
      votes: 0
    }
  ],
  
  // ç—…ä¾‹ä¿¡æ¯
  patientCase: {
    name: '',                         // æ‚£è€…å§“å
    gender: '',                       // æ€§åˆ«
    age: null,                        // å¹´é¾„
    pastHistory: '',                  // æ—¢å¾€ç—…å²
    currentProblem: '',               // å½“å‰é—®é¢˜
    imageRecognitionResult: '',       // å›¾åƒè¯†åˆ«ç»“æœæ±‡æ€»
    imageRecognitions: []             // å›¾åƒè¯†åˆ«è¯¦æƒ…
  },
  
  // å…³è”çš„å†å²é—®è¯Š
  linkedConsultations: [],
  
  // å·¥ä½œæµçŠ¶æ€
  workflow: {
    phase: 'setup',                   // setup | discussing | voting | summary | finished
    currentRound: 0,                  // å½“å‰è½®æ¬¡
    roundsWithoutElimination: 0,      // è¿ç»­æœªæ·˜æ±°è½®æ•°
    activeTurn: null,                 // å½“å‰å‘è¨€åŒ»ç”Ÿ ID
    turnQueue: [],                    // å‘è¨€é˜Ÿåˆ—
    isRunning: false,                 // æ˜¯å¦æ­£åœ¨è¿è¡Œ
    hasInitiatedVote: false,          // æ˜¯å¦å·²å‘èµ·æŠ•ç¥¨
    eliminatedInRound: null,          // æœ¬è½®æ·˜æ±°çš„åŒ»ç”Ÿ ID
    summaryInProgress: false          // æ˜¯å¦æ­£åœ¨ç”Ÿæˆæ€»ç»“
  },
  
  // å¯¹è¯å†å²
  messages: [
    {
      type: 'case',                   // case | discussion | vote
      role: 'system',                 // system | user | doctor
      doctorId: null,                 // åŒ»ç”Ÿ ID (å¦‚æœæ˜¯åŒ»ç”Ÿå‘è¨€)
      content: '...',                 // æ¶ˆæ¯å†…å®¹
      timestamp: 1234567890000,       // æ—¶é—´æˆ³
      roundNumber: 1,                 // è½®æ¬¡
      eliminated: false               // æ˜¯å¦å·²è¢«æ·˜æ±°çš„åŒ»ç”Ÿ
    }
  ],
  
  // æŠ•ç¥¨ç»Ÿè®¡
  voteTally: {
    'Dr. GPT-4': 2,
    'Dr. Claude': 1
  },
  
  // æœ€ç»ˆç­”æ¡ˆ
  finalAnswer: null
}
```

#### æ ¸å¿ƒ Actions

| Action | åŠŸèƒ½ | å‚æ•° |
|--------|------|------|
| `startConsultation()` | å¯åŠ¨ä¼šè¯Š | æ—  |
| `runDiscussion()` | è¿è¡Œè®¨è®ºè½®æ¬¡ | æ—  |
| `requestVote()` | å‘èµ·æŠ•ç¥¨ | æ—  |
| `processFinalSummary()` | ç”Ÿæˆæœ€ç»ˆæ€»ç»“ | æ—  |
| `endConsultation()` | ç»“æŸä¼šè¯Š | æ—  |
| `resetAll()` | é‡ç½®æ‰€æœ‰çŠ¶æ€ | æ—  |
| `setConsultationName(name)` | è®¾ç½®é—®è¯Šåç§° | name: string |
| `setPatientCase(data)` | è®¾ç½®ç—…ä¾‹ä¿¡æ¯ | data: object |
| `setDoctors(list)` | è®¾ç½®åŒ»ç”Ÿåˆ—è¡¨ | list: array |
| `setLinkedConsultations(list)` | è®¾ç½®å…³è”é—®è¯Š | list: array |

### 2. Global Store (src/store/global.js)

#### State ç»“æ„

```javascript
{
  // å…¨å±€åŒ»ç”Ÿé…ç½® (ä¸åŒ…å«è¿è¡Œæ—¶çŠ¶æ€)
  doctors: [
    {
      id: 'doc-1',
      name: 'Dr. GPT-4',
      provider: 'openai',
      model: 'gpt-4o-mini',
      apiKey: '',
      baseUrl: '',
      customPrompt: ''
    }
  ],
  
  // å›¾åƒè¯†åˆ«é…ç½®
  imageRecognition: {
    enabled: false,                    // æ˜¯å¦å¯ç”¨
    provider: 'siliconflow',           // ä¾›åº”å•†
    model: 'Pro/Qwen/Qwen2-VL-72B-Instruct',
    apiKey: '',
    baseUrl: '',
    prompt: 'è¯†åˆ«å½“å‰ç—…ç¶ç›¸å…³çš„å›¾ç‰‡å†…å®¹...',
    maxConcurrent: 1                   // æœ€å¤§å¹¶å‘æ•°
  },
  
  // é¢„è®¾æç¤ºè¯
  presetPrompts: [
    {
      id: 'preset-1',
      name: 'å¿ƒè¡€ç®¡å†…ç§‘åŒ»ç”Ÿ',
      prompt: 'ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å¿ƒè¡€ç®¡å†…ç§‘ä¸“å®¶åŒ»ç”Ÿ...'
    }
  ]
}
```

#### æ ¸å¿ƒ Actions

| Action | åŠŸèƒ½ | å‚æ•° |
|--------|------|------|
| `setDoctors(list)` | ä¿å­˜å…¨å±€åŒ»ç”Ÿé…ç½® | list: array |
| `setImageRecognition(config)` | ä¿å­˜å›¾åƒè¯†åˆ«é…ç½® | config: object |
| `setPresetPrompts(list)` | ä¿å­˜é¢„è®¾æç¤ºè¯ | list: array |

### 3. Sessions Store (src/store/sessions.js)

#### State ç»“æ„

```javascript
{
  // å½“å‰ä¼šè¯ ID
  currentId: null,
  
  // æ‰€æœ‰ä¼šè¯åˆ—è¡¨
  sessions: [
    {
      id: 'session-uuid',
      name: '2024-01-01 å¼ ä¸‰é—®è¯Š',
      createdAt: 1234567890000,
      updatedAt: 1234567890000,
      snapshot: {
        // å®Œæ•´çš„ consult store state
      }
    }
  ]
}
```

#### æ ¸å¿ƒ Actions

| Action | åŠŸèƒ½ | å‚æ•° |
|--------|------|------|
| `init()` | åˆå§‹åŒ–ä¼šè¯åˆ—è¡¨ | æ—  |
| `saveSnapshotFromConsult()` | ä¿å­˜å½“å‰ä¼šè¯Šå¿«ç…§ | æ—  |
| `switchSession(id)` | åˆ‡æ¢åˆ°æŒ‡å®šä¼šè¯ | id: string |
| `createNewSession()` | åˆ›å»ºæ–°ä¼šè¯ | æ—  |
| `deleteSession(id)` | åˆ é™¤ä¼šè¯ | id: string |
| `renameSession(id, name)` | é‡å‘½åä¼šè¯ | id: string, name: string |

---

## AI æ¨¡å‹é›†æˆ

### æ”¯æŒçš„ AI ä¾›åº”å•†

ç³»ç»Ÿæ”¯æŒ 5 ç§ AI ä¾›åº”å•†ç±»å‹ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥å…¥ä»»ä½•å…¼å®¹å¯¹åº”è§„èŒƒçš„æœåŠ¡ï¼š

#### 1. OpenAI è§„èŒƒ

**é»˜è®¤ Base URL**: `https://api.openai.com/v1`

**è¯·æ±‚æ ¼å¼**:
```javascript
POST /v1/chat/completions
Headers: {
  "Authorization": "Bearer {apiKey}",
  "Content-Type": "application/json"
}
Body: {
  "model": "gpt-4o",
  "messages": [
    {"role": "system", "content": "..."},
    {"role": "user", "content": "..."}
  ],
  "temperature": 0.7
}
```

**æ¨èæ¨¡å‹**:
- `gpt-4o` - æœ€æ–°ã€æœ€å¼ºå¤§
- `gpt-4o-mini` - æ›´å¿«ã€æ›´ç»æµ
- `gpt-4-turbo` - é«˜æ€§èƒ½

**å…¼å®¹æœåŠ¡**:
- OpenAI å®˜æ–¹
- Azure OpenAI
- å„ç±»å›½å†…ä»£ç†æœåŠ¡
- è‡ªéƒ¨ç½²çš„å…¼å®¹æœåŠ¡ (å¦‚ FastChat)

#### 2. Anthropic è§„èŒƒ

**é»˜è®¤ Base URL**: `https://api.anthropic.com/v1`

**è¯·æ±‚æ ¼å¼**:
```javascript
POST /v1/messages
Headers: {
  "x-api-key": "{apiKey}",
  "anthropic-version": "2023-06-01",
  "Content-Type": "application/json"
}
Body: {
  "model": "claude-3-5-sonnet-20241022",
  "system": "...",
  "messages": [...],
  "max_tokens": 1024
}
```

**æ¨èæ¨¡å‹**:
- `claude-3-5-sonnet-20241022` - æœ€æ–°æ——èˆ°
- `claude-3-opus-20240229` - æœ€å¼ºæ¨ç†
- `claude-3-haiku-20240307` - å¿«é€Ÿå“åº”

#### 3. Gemini è§„èŒƒ

**é»˜è®¤ Base URL**: `https://generativelanguage.googleapis.com/v1beta`

**è¯·æ±‚æ ¼å¼**:
```javascript
POST /v1beta/models/{model}:generateContent?key={apiKey}
Headers: {
  "Content-Type": "application/json"
}
Body: {
  "systemInstruction": {
    "role": "system",
    "parts": [{"text": "..."}]
  },
  "contents": [
    {
      "role": "user",
      "parts": [{"text": "..."}]
    }
  ]
}
```

**æ¨èæ¨¡å‹**:
- `gemini-1.5-pro` - æ——èˆ°æ¨¡å‹
- `gemini-1.5-flash` - å¿«é€Ÿæ¨¡å‹

#### 4. ç¡…åŸºæµåŠ¨

**é»˜è®¤ Base URL**: `https://api.siliconflow.cn/v1`

**è¯·æ±‚æ ¼å¼**: åŒ OpenAI è§„èŒƒ

**æ¨èæ¨¡å‹**:
- `Qwen/Qwen2.5-7B-Instruct` - é€šä¹‰åƒé—®
- `THUDM/glm-4-9b-chat` - æ™ºè°± GLM
- `Pro/Qwen/Qwen2.5-72B-Instruct` - é«˜æ€§èƒ½ç‰ˆ

**ç‰¹ç‚¹**:
- å›½å†…è®¿é—®é€Ÿåº¦å¿«
- æ”¯æŒä¼—å¤šå¼€æºæ¨¡å‹
- ä»·æ ¼ä½å»‰

**æ–‡æ¡£**: https://docs.siliconflow.cn/

#### 5. é­”æ­ç¤¾åŒº

**é»˜è®¤ Base URL**: `https://dashscope.aliyuncs.com/compatible-mode/v1`

**è¯·æ±‚æ ¼å¼**: åŒ OpenAI è§„èŒƒ

**æ¨èæ¨¡å‹**:
- `qwen-turbo` - é€šä¹‰åƒé—® Turbo
- `qwen-plus` - é€šä¹‰åƒé—® Plus
- `qwen-max` - é€šä¹‰åƒé—® Max

**ç‰¹ç‚¹**:
- é˜¿é‡Œäº‘å®˜æ–¹æœåŠ¡
- ç¨³å®šå¯é 
- æ”¯æŒé€šä¹‰åƒé—®å…¨ç³»åˆ—

**æ–‡æ¡£**: https://modelscope.cn/docs/model-service/API-Inference/intro

### æ·»åŠ æ–°çš„ AI ä¾›åº”å•†

å¦‚éœ€æ·»åŠ æ–°çš„ AI ä¾›åº”å•†ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

#### 1. ä¿®æ”¹ `src/api/callAI.js`

```javascript
// 1. æ·»åŠ ä¾›åº”å•†è°ƒç”¨å‡½æ•°
async function callNewProvider({ apiKey, model, fullPrompt, history, baseUrl }) {
  const messages = formatMessages(fullPrompt, history)
  const url = wrapUrlForDev(`${baseUrl}/your/endpoint`)
  
  const res = await axios.post(url, {
    // æ ¹æ®ä¾›åº”å•† API è§„èŒƒæ„å»ºè¯·æ±‚ä½“
    model,
    messages,
    // ... å…¶ä»–å‚æ•°
  }, {
    headers: {
      // æ ¹æ®ä¾›åº”å•†è¦æ±‚è®¾ç½® headers
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    }
  })
  
  // æå–å›å¤å†…å®¹
  return res.data.choices[0].message.content.trim()
}

// 2. åœ¨ callAI å‡½æ•°ä¸­æ·»åŠ  case
export async function callAI(doctor, fullPrompt, historyForProvider) {
  const { provider } = doctor
  
  switch (provider) {
    case 'openai':
      return callOpenAI(...)
    case 'newprovider':  // æ–°å¢
      return callNewProvider(...)
    default:
      throw new Error('Unsupported AI provider')
  }
}
```

#### 2. ä¿®æ”¹ `src/components/GlobalSettingsModal.vue`

```vue
<template>
  <a-select v-model:value="editingDoctor.provider">
    <a-select-option value="openai">OpenAIè§„èŒƒ</a-select-option>
    <!-- æ–°å¢é€‰é¡¹ -->
    <a-select-option value="newprovider">æ–°ä¾›åº”å•†</a-select-option>
  </a-select>
</template>
```

#### 3. æ·»åŠ æ¨¡å‹åˆ—è¡¨ (å¯é€‰)

ä¿®æ”¹ `src/api/models.js`:

```javascript
const MODEL_LISTS = {
  newprovider: [
    { value: 'model-1', label: 'Model 1' },
    { value: 'model-2', label: 'Model 2' }
  ]
}

export async function fetchModels(provider, apiKey, baseUrl) {
  if (provider === 'newprovider') {
    // å¦‚æœä¾›åº”å•†æä¾› API è·å–æ¨¡å‹åˆ—è¡¨
    // å¯ä»¥åœ¨è¿™é‡Œå®ç°
    return MODEL_LISTS.newprovider
  }
  // ...
}
```

---

## ä¸šåŠ¡æµç¨‹

### å®Œæ•´ä¼šè¯Šæµç¨‹å›¾

```mermaid
graph TD
    A[å¼€å§‹] --> B[ç”¨æˆ·è¾“å…¥ç—…ä¾‹ä¿¡æ¯]
    B --> C{æ˜¯å¦å¯ç”¨å›¾åƒè¯†åˆ«?}
    C -->|æ˜¯| D[ä¸Šä¼ å¹¶è¯†åˆ«åŒ»å­¦å½±åƒ]
    C -->|å¦| E[ç‚¹å‡»"å¼€å§‹ä¼šè¯Š"]
    D --> E
    
    E --> F[åˆå§‹åŒ–åŒ»ç”ŸçŠ¶æ€]
    F --> G[phase: discussing]
    
    G --> H[ç¡®å®šå‘è¨€é¡ºåº]
    H --> I[åŒ»ç”Ÿ1å‘è¨€]
    I --> J[è°ƒç”¨AI API]
    J --> K[å±•ç¤ºå›å¤ æ‰“å­—æœºæ•ˆæœ]
    
    K --> L{æ˜¯å¦æ‰€æœ‰åŒ»ç”Ÿå‘è¨€å®Œ?}
    L -->|å¦| M[ä¸‹ä¸€ä½åŒ»ç”Ÿå‘è¨€]
    M --> J
    
    L -->|æ˜¯| N[phase: voting]
    N --> O[æ‰€æœ‰åŒ»ç”Ÿè¿›è¡Œè¯„ä¼°æŠ•ç¥¨]
    O --> P[ç»Ÿè®¡æŠ•ç¥¨ç»“æœ]
    
    P --> Q{æ˜¯å¦æœ‰åŒ»ç”Ÿè¢«æ·˜æ±°?}
    Q -->|æ˜¯| R[æ ‡è®°åŒ»ç”Ÿä¸ºeliminated]
    Q -->|å¦| S[roundsWithoutElimination++]
    
    R --> T{å‰©ä½™åŒ»ç”Ÿæ•°é‡?}
    S --> U{æ˜¯å¦è¾¾åˆ°æœ€å¤§è½®æ•°?}
    
    T -->|= 1| V[phase: summary]
    T -->|> 1| W[currentRound++]
    
    U -->|æ˜¯| V
    U -->|å¦| W
    
    W --> G
    
    V --> X[è°ƒç”¨æœ€ç»ˆæ€»ç»“AI]
    X --> Y[ç”Ÿæˆå®Œæ•´è¯Šæ–­æŠ¥å‘Š]
    Y --> Z[phase: finished]
    Z --> AA[ä¿å­˜åˆ°localStorage]
    AA --> AB[ç»“æŸ]
```

### å…³é”®ä¸šåŠ¡é€»è¾‘

#### 1. å‘è¨€é¡ºåºå†³ç­–

```javascript
function determineTurnQueue(doctors, turnOrder) {
  const activeDoctors = doctors.filter(d => d.status === 'active')
  
  if (turnOrder === 'random') {
    // éšæœºæ‰“ä¹±é¡ºåº
    return shuffleArray(activeDoctors)
  } else {
    // æŒ‰åˆ—è¡¨é¡ºåº
    return [...activeDoctors]
  }
}
```

#### 2. æŠ•ç¥¨è§£æé€»è¾‘

```javascript
function parseVoteResponse(response, doctorNames) {
  // å°è¯•ä»å›å¤ä¸­æå–åŒ»ç”Ÿåå­—
  for (const name of doctorNames) {
    if (response.includes(name)) {
      return name
    }
  }
  
  // å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å› null
  return null
}
```

#### 3. æ·˜æ±°å†³ç­–é€»è¾‘

```javascript
function determineElimination(voteTally, doctors) {
  // æ‰¾å‡ºè·å¾—æœ€å¤šç¥¨æ•°çš„åŒ»ç”Ÿ
  const maxVotes = Math.max(...Object.values(voteTally))
  
  // å¦‚æœæ²¡æœ‰äººè·å¾—æŠ•ç¥¨ï¼Œä¸æ·˜æ±°ä»»ä½•äºº
  if (maxVotes === 0) {
    return null
  }
  
  // æ‰¾å‡ºæ‰€æœ‰è·å¾—æœ€é«˜ç¥¨æ•°çš„åŒ»ç”Ÿ
  const candidates = Object.entries(voteTally)
    .filter(([name, votes]) => votes === maxVotes)
    .map(([name]) => name)
  
  // å¦‚æœæœ‰å¤šäººå¹¶åˆ—ï¼Œä¸æ·˜æ±°ï¼ˆé¿å…ä¸å…¬å¹³ï¼‰
  if (candidates.length > 1) {
    return null
  }
  
  // è¿”å›è¦æ·˜æ±°çš„åŒ»ç”Ÿ ID
  return findDoctorIdByName(candidates[0], doctors)
}
```

#### 4. ç»“æŸæ¡ä»¶åˆ¤æ–­

```javascript
function shouldEndConsultation(workflow, activeDoctors) {
  // æ¡ä»¶1: åªå‰©ä¸€ä½åŒ»ç”Ÿ
  if (activeDoctors.length === 1) {
    return { shouldEnd: true, reason: 'only-one-left' }
  }
  
  // æ¡ä»¶2: è¿ç»­å¤šè½®æ— æ·˜æ±°
  if (workflow.roundsWithoutElimination >= settings.maxRoundsWithoutElimination) {
    return { shouldEnd: true, reason: 'max-rounds-reached' }
  }
  
  return { shouldEnd: false }
}
```

---

## æ•°æ®æŒä¹…åŒ–

### LocalStorage æ¶æ„

ç³»ç»Ÿä½¿ç”¨æµè§ˆå™¨çš„ `localStorage` è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä¸»è¦å­˜å‚¨ä»¥ä¸‹å†…å®¹ï¼š

#### 1. å…¨å±€åŒ»ç”Ÿé…ç½®

**Key**: `global_doctors_config`

**æ•°æ®ç»“æ„**:
```json
[
  {
    "id": "doc-1",
    "name": "Dr. GPT-4",
    "provider": "openai",
    "model": "gpt-4o-mini",
    "apiKey": "sk-...",
    "baseUrl": "",
    "customPrompt": ""
  }
]
```

**ç‰¹ç‚¹**:
- ä¸åŒ…å«è¿è¡Œæ—¶çŠ¶æ€ (status, votes)
- åœ¨å…¨å±€è®¾ç½®ä¸­ç®¡ç†
- åˆ›å»ºæ–°ä¼šè¯Šæ—¶ä½œä¸ºæ¨¡æ¿ä½¿ç”¨

#### 2. å›¾åƒè¯†åˆ«é…ç½®

**Key**: `global_image_recognition_config`

**æ•°æ®ç»“æ„**:
```json
{
  "enabled": false,
  "provider": "siliconflow",
  "model": "Pro/Qwen/Qwen2-VL-72B-Instruct",
  "apiKey": "",
  "baseUrl": "",
  "prompt": "è¯†åˆ«å½“å‰ç—…ç¶ç›¸å…³çš„å›¾ç‰‡å†…å®¹...",
  "maxConcurrent": 1
}
```

#### 3. é¢„è®¾æç¤ºè¯

**Key**: `global_preset_prompts`

**æ•°æ®ç»“æ„**:
```json
[
  {
    "id": "preset-1",
    "name": "å¿ƒè¡€ç®¡å†…ç§‘åŒ»ç”Ÿ",
    "prompt": "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å¿ƒè¡€ç®¡å†…ç§‘ä¸“å®¶åŒ»ç”Ÿ..."
  }
]
```

#### 4. ä¼šè¯åˆ—è¡¨

**Key**: `sessions_list`

**æ•°æ®ç»“æ„**:
```json
{
  "currentId": "session-uuid-1",
  "sessions": [
    {
      "id": "session-uuid-1",
      "name": "2024-01-01 å¼ ä¸‰é—®è¯Š",
      "createdAt": 1704067200000,
      "updatedAt": 1704070800000,
      "snapshot": {
        "consultationName": "å¼ ä¸‰çš„æ„Ÿå†’é—®è¯Š",
        "settings": {...},
        "doctors": [...],
        "patientCase": {...},
        "workflow": {...},
        "messages": [...],
        "voteTally": {...},
        "finalAnswer": "...",
        "linkedConsultations": [...]
      }
    }
  ]
}
```

### è‡ªåŠ¨ä¿å­˜æœºåˆ¶

**æ–‡ä»¶**: `src/App.vue`

```javascript
// ç›‘å¬ consult store çš„å˜åŒ–ï¼Œé˜²æŠ–ä¿å­˜
watch(
  () => consult.$state,
  () => {
    if (saveTimer) clearTimeout(saveTimer)
    saveTimer = setTimeout(() => {
      sessions.saveSnapshotFromConsult()
    }, 500)  // 500ms é˜²æŠ–
  },
  { deep: true }
)
```

**ä¿å­˜æ—¶æœº**:
- ç”¨æˆ·è¾“å…¥ç—…ä¾‹ä¿¡æ¯
- åŒ»ç”Ÿå‘è¨€å
- æŠ•ç¥¨å®Œæˆå
- æœ€ç»ˆæ€»ç»“ç”Ÿæˆå
- ä»»ä½•çŠ¶æ€å˜æ›´å (500ms é˜²æŠ–)

### æ•°æ®è¿ç§»å’Œå¤‡ä»½

ç”±äºæ•°æ®å­˜å‚¨åœ¨ localStorageï¼Œç”¨æˆ·å¯ä»¥ï¼š

1. **å¯¼å‡ºæ•°æ®** (TODO: å¾…å®ç°):
```javascript
function exportAllData() {
  const data = {
    doctors: localStorage.getItem('global_doctors_config'),
    imageRecognition: localStorage.getItem('global_image_recognition_config'),
    presetPrompts: localStorage.getItem('global_preset_prompts'),
    sessions: localStorage.getItem('sessions_list')
  }
  
  const json = JSON.stringify(data, null, 2)
  downloadAsFile('ai-doctor-backup.json', json)
}
```

2. **å¯¼å…¥æ•°æ®** (TODO: å¾…å®ç°):
```javascript
function importData(jsonString) {
  const data = JSON.parse(jsonString)
  
  if (data.doctors) {
    localStorage.setItem('global_doctors_config', data.doctors)
  }
  // ... å…¶ä»–æ•°æ®
  
  // é‡æ–°åŠ è½½
  location.reload()
}
```

---

## å¼€å‘æŒ‡å—

### ç¯å¢ƒæ­å»º

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd ai-medical-consultation-panel
```

#### 2. å®‰è£…ä¾èµ–

æ¨èä½¿ç”¨ pnpm (é€Ÿåº¦æ›´å¿«ï¼Œç£ç›˜å ç”¨æ›´å°‘):

```bash
pnpm install
```

æˆ–ä½¿ç”¨ npm:

```bash
npm install
```

#### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
# æˆ–
npm run dev
```

è®¿é—®: http://localhost:5173

#### 4. é…ç½® API Key

åœ¨åº”ç”¨ä¸­ç‚¹å‡»"å…¨å±€è®¾ç½®"ï¼Œæ·»åŠ åŒ»ç”Ÿå¹¶é…ç½® API Keyã€‚

### å¼€å‘è°ƒè¯•

#### 1. Vue Devtools

æ¨èå®‰è£… [Vue Devtools](https://devtools.vuejs.org/) æµè§ˆå™¨æ‰©å±•ï¼Œå¯ä»¥ï¼š
- æŸ¥çœ‹ç»„ä»¶æ ‘
- æ£€æŸ¥ç»„ä»¶çŠ¶æ€
- è°ƒè¯• Pinia Store
- æŸ¥çœ‹äº‹ä»¶

#### 2. æŸ¥çœ‹ Store çŠ¶æ€

åœ¨æµè§ˆå™¨æ§åˆ¶å°:

```javascript
// è·å– store å®ä¾‹
const { useConsultStore, useGlobalStore, useSessionsStore } = window.__PINIA_STORES__

// æŸ¥çœ‹çŠ¶æ€
console.log(useConsultStore().$state)
console.log(useGlobalStore().$state)
console.log(useSessionsStore().$state)
```

#### 3. æ¨¡æ‹Ÿ AI å›å¤

å¦‚æœä¸æƒ³æ¶ˆè€— API è°ƒç”¨ï¼Œå¯ä»¥åœ¨ `src/api/callAI.js` ä¸­ä¸é…ç½® `apiKey`ï¼Œç³»ç»Ÿä¼šè¿”å›æ¨¡æ‹Ÿå›å¤ï¼š

```javascript
if (!apiKey) {
  await sleep(600)
  return `ã€æ¨¡æ‹Ÿå›å¤ - ${doctor.name}ã€‘\næ ¹æ®æä¾›çš„ç—…å†ä¸è®¨è®ºå†å²ï¼Œæˆ‘è®¤ä¸ºéœ€è¦è¿›ä¸€æ­¥å®Œå–„ä½“æ ¼æ£€æŸ¥ä¸è¾…åŠ©æ£€æŸ¥ä»¥æ˜ç¡®è¯Šæ–­ã€‚`
}
```

#### 4. æ¸…é™¤ localStorage

è°ƒè¯•æ—¶å¯èƒ½éœ€è¦æ¸…é™¤æœ¬åœ°æ•°æ®ï¼š

```javascript
// æ¸…é™¤æ‰€æœ‰æ•°æ®
localStorage.clear()

// æ¸…é™¤ç‰¹å®šæ•°æ®
localStorage.removeItem('global_doctors_config')
localStorage.removeItem('sessions_list')

// åˆ·æ–°é¡µé¢
location.reload()
```

### ä»£ç è§„èŒƒ

#### 1. Vue ç»„ä»¶

- ä½¿ç”¨ **ç»„åˆå¼ API** (Composition API)
- ä½¿ç”¨ `<script setup>` è¯­æ³•
- Props ä½¿ç”¨ `defineProps()`
- Emits ä½¿ç”¨ `defineEmits()`

ç¤ºä¾‹:

```vue
<template>
  <div>{{ message }}</div>
</template>

<script setup>
import { ref, computed } from 'vue'

const props = defineProps({
  title: String
})

const emit = defineEmits(['update'])

const message = ref('Hello')

const computedValue = computed(() => {
  return props.title + message.value
})

function handleClick() {
  emit('update', message.value)
}
</script>
```

#### 2. Pinia Store

- Action ä¸­ä½¿ç”¨ `this` è®¿é—® state
- ä¸éœ€è¦ mutationsï¼Œç›´æ¥ä¿®æ”¹ state
- å¤æ‚é€»è¾‘å°è£…åœ¨ actions ä¸­

ç¤ºä¾‹:

```javascript
export const useMyStore = defineStore('myStore', {
  state: () => ({
    count: 0
  }),
  
  getters: {
    doubleCount: (state) => state.count * 2
  },
  
  actions: {
    increment() {
      this.count++
    },
    
    async fetchData() {
      const data = await api.get()
      this.count = data.count
    }
  }
})
```

#### 3. å‘½åè§„èŒƒ

- **ç»„ä»¶æ–‡ä»¶**: PascalCase (å¦‚ `GlobalSettingsModal.vue`)
- **å·¥å…·æ–‡ä»¶**: camelCase (å¦‚ `prompt.js`)
- **å˜é‡**: camelCase (å¦‚ `currentRound`)
- **å¸¸é‡**: UPPER_SNAKE_CASE (å¦‚ `MAX_ROUNDS`)
- **ç»„ä»¶å**: PascalCase (å¦‚ `<GlobalSettingsModal />`)

### æ·»åŠ æ–°åŠŸèƒ½

#### ç¤ºä¾‹: æ·»åŠ "åŒ»ç”Ÿä¸“é•¿æ ‡ç­¾"åŠŸèƒ½

**1. ä¿®æ”¹æ•°æ®ç»“æ„** (src/store/index.js):

```javascript
state: () => ({
  doctors: [
    {
      // ... ç°æœ‰å­—æ®µ
      specialties: ['å¿ƒè¡€ç®¡', 'é«˜è¡€å‹'] // æ–°å¢å­—æ®µ
    }
  ]
})
```

**2. ä¿®æ”¹ UI** (src/components/GlobalSettingsModal.vue):

```vue
<template>
  <a-form-item label="ä¸“é•¿æ ‡ç­¾">
    <a-select
      v-model:value="editingDoctor.specialties"
      mode="tags"
      placeholder="è¾“å…¥ä¸“é•¿æ ‡ç­¾"
    />
  </a-form-item>
</template>
```

**3. æ˜¾ç¤ºæ ‡ç­¾** (src/components/DoctorList.vue):

```vue
<template>
  <a-tag v-for="tag in doctor.specialties" :key="tag">
    {{ tag }}
  </a-tag>
</template>
```

**4. åœ¨æç¤ºè¯ä¸­ä½¿ç”¨** (src/utils/prompt.js):

```javascript
export function buildFullPrompt(doctor, patientCase, messages) {
  const specialtyText = doctor.specialties?.length 
    ? `ä½ çš„ä¸“é•¿é¢†åŸŸæ˜¯: ${doctor.specialties.join('ã€')}\n`
    : ''
  
  return {
    system: `${specialtyText}${doctor.customPrompt || globalPrompt}`,
    user: `...`
  }
}
```

---

## éƒ¨ç½²è¯´æ˜

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
# æˆ–
npm run build
```

æ„å»ºäº§ç‰©åœ¨ `dist/` ç›®å½•ã€‚

### éƒ¨ç½²æ–¹å¼

#### 1. é™æ€æ‰˜ç®¡ (æ¨è)

**é€‚ç”¨å¹³å°**:
- GitHub Pages
- Vercel
- Netlify
- Cloudflare Pages

**éƒ¨ç½²æ­¥éª¤** (ä»¥ GitHub Pages ä¸ºä¾‹):

```bash
# 1. æ„å»º
pnpm build

# 2. è¿›å…¥æ„å»ºç›®å½•
cd dist

# 3. åˆå§‹åŒ– git å¹¶æ¨é€
git init
git add -A
git commit -m 'deploy'
git push -f git@github.com:username/repo.git master:gh-pages

# 4. åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­å¯ç”¨ GitHub Pages
# é€‰æ‹© gh-pages åˆ†æ”¯
```

#### 2. è‡ªå»ºæœåŠ¡å™¨

**Nginx é…ç½®**:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /var/www/ai-doctor/dist;
    index index.html;
    
    # SPA è·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";
    add_header X-XSS-Protection "1; mode=block";
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.production`:

```bash
# æ˜¯å¦å¯ç”¨ä»£ç† (å¦‚æœéƒ¨ç½²ç¯å¢ƒæœ‰ nginx ä»£ç†)
VITE_ENABLE_PROXY=false
```

### CORS é—®é¢˜

ç”±äºç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹ APIï¼Œå¯èƒ½é‡åˆ° CORS è·¨åŸŸé—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**:

#### æ–¹æ¡ˆ 1: ä½¿ç”¨å®˜æ–¹æ”¯æŒçš„åŸŸå

éƒ¨åˆ† AI æœåŠ¡å•†ï¼ˆå¦‚ OpenAIã€Anthropicï¼‰å…è®¸æµè§ˆå™¨ç›´æ¥è°ƒç”¨ APIï¼Œä¸ä¼šæœ‰ CORS é—®é¢˜ã€‚

#### æ–¹æ¡ˆ 2: Nginx ä»£ç†

åœ¨æœåŠ¡å™¨é…ç½® Nginx åå‘ä»£ç†:

```nginx
# ä»£ç† OpenAI API
location /api/openai/ {
    proxy_pass https://api.openai.com/v1/;
    proxy_set_header Host api.openai.com;
    proxy_set_header Authorization $http_authorization;
}

# ä»£ç† Anthropic API
location /api/anthropic/ {
    proxy_pass https://api.anthropic.com/v1/;
    proxy_set_header Host api.anthropic.com;
    proxy_set_header x-api-key $http_x_api_key;
}
```

ä¿®æ”¹åŒ»ç”Ÿé…ç½®çš„ Base URL:
- OpenAI: `https://your-domain.com/api/openai`
- Anthropic: `https://your-domain.com/api/anthropic`

#### æ–¹æ¡ˆ 3: ä½¿ç”¨å›½å†…ä»£ç†æœåŠ¡

ä½¿ç”¨æ”¯æŒ CORS çš„å›½å†… API ä»£ç†æœåŠ¡ã€‚

---

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„è¯„ä¼°æœºåˆ¶

å½“å‰ç³»ç»Ÿä½¿ç”¨"æŠ•ç¥¨æ·˜æ±°"æœºåˆ¶ï¼Œä½ å¯ä»¥æ·»åŠ æ–°çš„è¯„ä¼°æ–¹å¼ï¼š

#### ç¤ºä¾‹: æ·»åŠ "è¯„åˆ†æœºåˆ¶"

**1. ä¿®æ”¹æŠ•ç¥¨æç¤ºè¯** (src/utils/prompt.js):

```javascript
export function buildVotePrompt(doctor, messages, activeDoctors) {
  return {
    system: "ä½ æ˜¯åŒ»ç”Ÿè¯„å®¡å§”å‘˜",
    user: `
è¯·ä¸ºæ¯ä½åŒ»ç”Ÿçš„è¯Šæ–­æ‰“åˆ† (1-10åˆ†):

${activeDoctors.map(d => `- ${d.name}`).join('\n')}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡º:
Dr. GPT-4: 8
Dr. Claude: 7
...
    `
  }
}
```

**2. è§£æè¯„åˆ†** (src/store/index.js):

```javascript
function parseScores(response, doctorNames) {
  const scores = {}
  
  for (const name of doctorNames) {
    const regex = new RegExp(`${name}:\\s*(\\d+)`)
    const match = response.match(regex)
    if (match) {
      scores[name] = parseInt(match[1])
    }
  }
  
  return scores
}
```

**3. æ ¹æ®è¯„åˆ†å†³å®šæ·˜æ±°** (src/store/index.js):

```javascript
async requestVote() {
  const allScores = []
  
  // æ¯ä½åŒ»ç”Ÿè¯„åˆ†
  for (const doctor of activeDoctors) {
    const votePrompt = buildVotePrompt(...)
    const response = await callAI(...)
    const scores = parseScores(response, doctorNames)
    allScores.push(scores)
  }
  
  // è®¡ç®—å¹³å‡åˆ†
  const avgScores = calculateAverageScores(allScores)
  
  // æ·˜æ±°æœ€ä½åˆ† (å¦‚æœåˆ†å·®æ˜¾è‘—)
  const minScore = Math.min(...Object.values(avgScores))
  const maxScore = Math.max(...Object.values(avgScores))
  
  if (maxScore - minScore >= 2) {  // åˆ†å·®é˜ˆå€¼
    const eliminated = findDoctorWithScore(minScore)
    eliminated.status = 'eliminated'
  }
  
  // ...
}
```

### æ·»åŠ å¯¼å‡ºåŠŸèƒ½

#### å¯¼å‡ºä¸º PDF

```bash
npm install jspdf
```

```javascript
import jsPDF from 'jspdf'

export function exportToPDF(consultation) {
  const doc = new jsPDF()
  
  // æ·»åŠ æ ‡é¢˜
  doc.setFontSize(20)
  doc.text('AI åŒ»ç–—ä¼šè¯ŠæŠ¥å‘Š', 20, 20)
  
  // æ·»åŠ ç—…ä¾‹ä¿¡æ¯
  doc.setFontSize(12)
  doc.text(`æ‚£è€…: ${consultation.patientCase.name}`, 20, 40)
  doc.text(`å¹´é¾„: ${consultation.patientCase.age}`, 20, 50)
  
  // æ·»åŠ è¯Šæ–­å†…å®¹
  doc.text('æœ€ç»ˆè¯Šæ–­:', 20, 70)
  doc.text(consultation.finalAnswer, 20, 80, { maxWidth: 170 })
  
  // ä¿å­˜
  doc.save('consultation-report.pdf')
}
```

#### å¯¼å‡ºä¸º Word

```bash
npm install docx file-saver
```

```javascript
import { Document, Packer, Paragraph, TextRun } from 'docx'
import { saveAs } from 'file-saver'

export async function exportToWord(consultation) {
  const doc = new Document({
    sections: [{
      properties: {},
      children: [
        new Paragraph({
          children: [
            new TextRun({
              text: 'AI åŒ»ç–—ä¼šè¯ŠæŠ¥å‘Š',
              bold: true,
              size: 28
            })
          ]
        }),
        new Paragraph({
          children: [
            new TextRun({
              text: `æ‚£è€…: ${consultation.patientCase.name}`
            })
          ]
        }),
        // ... æ›´å¤šå†…å®¹
      ]
    }]
  })
  
  const blob = await Packer.toBlob(doc)
  saveAs(blob, 'consultation-report.docx')
}
```

### æ·»åŠ è¯­éŸ³åŠŸèƒ½

#### è¯­éŸ³è¾“å…¥

```javascript
export function startVoiceInput(onResult) {
  if (!('webkitSpeechRecognition' in window)) {
    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«')
    return
  }
  
  const recognition = new webkitSpeechRecognition()
  recognition.lang = 'zh-CN'
  recognition.continuous = false
  recognition.interimResults = false
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript
    onResult(transcript)
  }
  
  recognition.start()
}
```

#### è¯­éŸ³æ’­æŠ¥

```javascript
export function speakText(text) {
  if (!('speechSynthesis' in window)) {
    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æ’­æŠ¥')
    return
  }
  
  const utterance = new SpeechSynthesisUtterance(text)
  utterance.lang = 'zh-CN'
  utterance.rate = 1.0
  utterance.pitch = 1.0
  
  speechSynthesis.speak(utterance)
}
```

### æ·»åŠ åä½œåŠŸèƒ½

#### ä½¿ç”¨ WebSocket å®ç°å¤šäººåä½œ

**1. å®‰è£… Socket.IO å®¢æˆ·ç«¯**:

```bash
npm install socket.io-client
```

**2. åˆ›å»ºåä½œ Store** (src/store/collaboration.js):

```javascript
import { defineStore } from 'pinia'
import { io } from 'socket.io-client'

export const useCollaborationStore = defineStore('collaboration', {
  state: () => ({
    socket: null,
    roomId: null,
    participants: []
  }),
  
  actions: {
    connect(roomId) {
      this.socket = io('wss://your-server.com')
      this.roomId = roomId
      
      this.socket.emit('join-room', roomId)
      
      this.socket.on('user-joined', (user) => {
        this.participants.push(user)
      })
      
      this.socket.on('message-update', (message) => {
        // åŒæ­¥æ¶ˆæ¯
        const consultStore = useConsultStore()
        consultStore.messages.push(message)
      })
    },
    
    disconnect() {
      if (this.socket) {
        this.socket.disconnect()
        this.socket = null
      }
    },
    
    broadcastMessage(message) {
      if (this.socket) {
        this.socket.emit('new-message', {
          roomId: this.roomId,
          message
        })
      }
    }
  }
})
```

**3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨**:

```vue
<script setup>
import { useCollaborationStore } from '@/store/collaboration'

const collaboration = useCollaborationStore()

onMounted(() => {
  const roomId = route.query.room || generateRoomId()
  collaboration.connect(roomId)
})

onBeforeUnmount(() => {
  collaboration.disconnect()
})
</script>
```

---

## å¸¸è§é—®é¢˜

### 1. CORS è·¨åŸŸé—®é¢˜

**é—®é¢˜**: è°ƒç”¨ AI API æ—¶å‡ºç° CORS é”™è¯¯

**è§£å†³**:
- ä½¿ç”¨å®˜æ–¹æ”¯æŒæµè§ˆå™¨è°ƒç”¨çš„ API
- é…ç½® Nginx åå‘ä»£ç†
- ä½¿ç”¨æ”¯æŒ CORS çš„ä»£ç†æœåŠ¡

### 2. API Key å®‰å…¨

**é—®é¢˜**: API Key å­˜å‚¨åœ¨æµè§ˆå™¨ä¸å®‰å…¨

**è¯´æ˜**: 
- æœ¬ç³»ç»Ÿè®¾è®¡ä¸ºä¸ªäººä½¿ç”¨å·¥å…·
- API Key ä»…å­˜å‚¨åœ¨ç”¨æˆ·è‡ªå·±çš„æµè§ˆå™¨
- ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨

**å»ºè®®**:
- ä½¿ç”¨é™é¢è¾ƒå°çš„ API Key
- å®šæœŸæ›´æ¢ API Key
- ä¸è¦åœ¨å…¬å…±ç”µè„‘ä¸Šä½¿ç”¨

### 3. æ•°æ®ä¸¢å¤±

**é—®é¢˜**: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åæ•°æ®ä¸¢å¤±

**è§£å†³**:
- å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½ (å¾…å¼€å‘)
- å®šæœŸå¤‡ä»½é‡è¦ä¼šè¯Šè®°å½•
- ä½¿ç”¨æµè§ˆå™¨çš„"ä¸æ¸…é™¤ç‰¹å®šç½‘ç«™æ•°æ®"åŠŸèƒ½

### 4. AI å›å¤é€Ÿåº¦æ…¢

**é—®é¢˜**: æŸäº› AI æ¨¡å‹å“åº”å¾ˆæ…¢

**ä¼˜åŒ–**:
- é€‰æ‹©æ›´å¿«çš„æ¨¡å‹ (å¦‚ GPT-4o-mini, Claude Haiku)
- å‡å°‘å‚ä¸ä¼šè¯Šçš„åŒ»ç”Ÿæ•°é‡
- ä½¿ç”¨å›½å†… AI æœåŠ¡å•† (å¦‚ç¡…åŸºæµåŠ¨)

### 5. æ‰“å­—æœºæ•ˆæœå¡é¡¿

**é—®é¢˜**: é•¿æ–‡æœ¬çš„æ‰“å­—æœºæ•ˆæœå¯¼è‡´é¡µé¢å¡é¡¿

**ä¼˜åŒ–**:
- è°ƒæ•´æ‰“å­—é€Ÿåº¦ (ä¿®æ”¹ `ChatDisplay.vue` ä¸­çš„ delay)
- ä½¿ç”¨ `requestAnimationFrame` ä¼˜åŒ–åŠ¨ç”»
- é•¿æ–‡æœ¬è·³è¿‡æ‰“å­—æœºæ•ˆæœç›´æ¥æ˜¾ç¤º

---

## æ›´æ–°æ—¥å¿—

### v0.1.0 (å½“å‰ç‰ˆæœ¬)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å¤šåŒ»ç”Ÿåä½œä¼šè¯Š
- âœ… æŠ•ç¥¨æ·˜æ±°æœºåˆ¶
- âœ… æœ€ç»ˆè¯Šæ–­æ€»ç»“
- âœ… ä¼šè¯ç®¡ç†
- âœ… å›¾åƒè¯†åˆ«
- âœ… å…³è”é—®è¯Š
- âœ… é¢„è®¾æç¤ºè¯

**æ”¯æŒçš„ AI ä¾›åº”å•†**:
- âœ… OpenAI
- âœ… Anthropic Claude
- âœ… Google Gemini
- âœ… ç¡…åŸºæµåŠ¨
- âœ… é­”æ­ç¤¾åŒº

**å·²çŸ¥é—®é¢˜**:
- éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒæŸäº› AI API
- é•¿æ—¶é—´è¿è¡Œå¯èƒ½å ç”¨å¤§é‡å†…å­˜
- ç¼ºå°‘æ•°æ®å¯¼å‡ºåŠŸèƒ½

### æœªæ¥è§„åˆ’

**v0.2.0**:
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½ (PDF, Word, JSON)
- [ ] è¯­éŸ³è¾“å…¥/è¾“å‡º
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] æ›´å¤š AI æ¨¡å‹æ”¯æŒ

**v0.3.0**:
- [ ] åä½œæ¨¡å¼ (å¤šäººå®æ—¶åä½œ)
- [ ] åŒ»å­¦çŸ¥è¯†åº“é›†æˆ
- [ ] è¯Šæ–­è´¨é‡è¯„ä¼°
- [ ] ç»Ÿè®¡æŠ¥è¡¨

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### æäº¤ Issue

**Bug æŠ¥å‘Š**åº”åŒ…å«:
- é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- é¢„æœŸè¡Œä¸º
- å®é™…è¡Œä¸º
- æµè§ˆå™¨ç‰ˆæœ¬
- é”™è¯¯æˆªå›¾/æ—¥å¿—

**åŠŸèƒ½å»ºè®®**åº”åŒ…å«:
- åŠŸèƒ½æè¿°
- ä½¿ç”¨åœºæ™¯
- é¢„æœŸæ•ˆæœ
- å¯é€‰: å®ç°æ€è·¯

### æäº¤ Pull Request

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/AmazingFeature`
5. æäº¤ Pull Request

**Pull Request è¦æ±‚**:
- éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- é€šè¿‡ ESLint æ£€æŸ¥
- åŠŸèƒ½å®Œæ•´å¯ç”¨
- ä¸å¼•å…¥æ–°çš„ Bug

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯å¼€æºã€‚

**MIT License**

Copyright (c) 2024 AI Medical Consultation Panel Team

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---

## è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/DragonChenCL/ai-doctor
- **åœ¨çº¿æ¼”ç¤º**: https://dragonchencl.github.io/ai-doctor/
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/DragonChenCL/ai-doctor/issues)

---

<div align="center">

**Made with â¤ï¸ by the AI Medical Consultation Panel Team**

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ï¸ Starï¼

</div>
